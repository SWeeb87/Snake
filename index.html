<script>
    function unityShowBanner(msg, type) {
    var warningBanner = document.querySelector("#unity-warning");
    function updateBannerVisibility() {
      warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
    }
    var div = document.createElement('div');
    div.innerHTML = msg;
    warningBanner.appendChild(div);
    if (type == 'error') div.style = 'background: red; padding: 10px;';
    else {
      if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
      setTimeout(function() {
        warningBanner.removeChild(div);
        updateBannerVisibility();
      }, 5000);
    }
    updateBannerVisibility();
  }
  
  async function loadWasmParts() {
    const parts = [
      "Build/Snake Build.wasm.part0",
      "Build/Snake Build.wasm.part1"
    ];

    const responses = await Promise.all(parts.map(url => fetch(url)));
    const buffers = await Promise.all(responses.map(response => response.arrayBuffer()));
    const fullWasm = new Uint8Array(buffers.reduce((acc, buffer) => acc.concat(Array.from(new Uint8Array(buffer))), []));

    return new Blob([fullWasm], { type: "application/wasm" });
  }

  // Modifica il caricamento di Unity per usare il WASM ricombinato
  loadWasmParts().then(wasmBlob => {
    const url = URL.createObjectURL(wasmBlob);
    var config = {
      arguments: [],
      dataUrl: "Build/Snake Build.data",
      frameworkUrl: "Build/Snake Build.framework.js",
      codeUrl: url, // Usa il WASM ricombinato
      streamingAssetsUrl: "StreamingAssets",
      companyName: "SWeeb",
      productName: "Snake",
      productVersion: "1.0",
      showBanner: unityShowBanner,
    };

    createUnityInstance(document.querySelector("#unity-canvas"), config, (progress) => {
      document.querySelector("#unity-progress-bar-full").style.width = 100 * progress + "%";
    }).catch((err) => {
      console.error(err);
      alert("Errore durante il caricamento del gioco.");
    });
  });
</script>
