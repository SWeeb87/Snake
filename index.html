<script>
  async function loadWasmParts() {
    const parts = [
      "Build/Snake Build.wasm.part0",
      "Build/Snake Build.wasm.part1"
    ];

    const responses = await Promise.all(parts.map(url => fetch(url)));
    const buffers = await Promise.all(responses.map(response => response.arrayBuffer()));
    const fullWasm = new Uint8Array(buffers.reduce((acc, buffer) => acc.concat(Array.from(new Uint8Array(buffer))), []));

    return new Blob([fullWasm], { type: "application/wasm" });
  }

  // Modifica il caricamento di Unity per usare il WASM ricombinato
  loadWasmParts().then(wasmBlob => {
    const url = URL.createObjectURL(wasmBlob);
    var config = {
      arguments: [],
      dataUrl: "Build/Snake Build.data",
      frameworkUrl: "Build/Snake Build.framework.js",
      codeUrl: url, // Usa il WASM ricombinato
      streamingAssetsUrl: "StreamingAssets",
      companyName: "SWeeb",
      productName: "Snake",
      productVersion: "1.0",
      showBanner: unityShowBanner,
    };

    createUnityInstance(document.querySelector("#unity-canvas"), config, (progress) => {
      document.querySelector("#unity-progress-bar-full").style.width = 100 * progress + "%";
    }).catch((err) => {
      console.error(err);
      alert("Errore durante il caricamento del gioco.");
    });
  });
</script>
