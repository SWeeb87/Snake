<!DOCTYPE html>
<html>
<head>
    <title>Snake Game</title>
    <!-- Includi la libreria JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <style>
        #progressContainer {
            width: 100%;
            background-color: #ddd;
            margin-bottom: 10px;
        }
        #progressBar {
            width: 0;
            height: 30px;
            text-align: center;
            line-height: 30px;
            color: white;
            background-color: #4caf50;
        }
    </style>
</head>
<body>
    <h1>Loading Snake Game...</h1>
    <div id="progressContainer">
        <div id="progressBar">0%</div>
    </div>
    <div id="unityContainer" style="width: 800px; height: 600px; margin-top: 20px;"></div>

    <!-- Script principale -->
    <script>
        async function downloadAndDecompressZip(url, progressCallback) {
            const response = await fetch(url);
            const blob = await response.blob();
            const zip = await JSZip.loadAsync(blob);

            const totalFiles = Object.keys(zip.files).length;
            let processedFiles = 0;

            for (const filename in zip.files) {
                const file = zip.files[filename];
                if (!file.dir) {
                    const content = await file.async("blob");
                    // Simula il salvataggio o utilizza il contenuto in base alle necessitÃ .

                    // Aggiorna la barra di progresso
                    processedFiles++;
                    const percentage = Math.floor((processedFiles / totalFiles) * 100);
                    progressCallback(percentage);
                }
            }
        }

        async function loadAndInitializeGame() {
            const buildZipUrl = "https://github.com/SWeeb87/Snake/releases/download/1.0/Build.zip";
            const templateDataZipUrl = "https://github.com/SWeeb87/Snake/releases/download/1.0/TemplateData.zip";

            // Decompressione dei file
            await downloadAndDecompressZip(buildZipUrl, (progress) => {
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressBar').textContent = `${progress}%`;
            });

            // Decompressione di TemplateData
            await downloadAndDecompressZip(templateDataZipUrl, (progress) => {
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressBar').textContent = `${progress}%`;
            });

            // Caricamento e inizializzazione di Unity
            try {
                const unityInstance = await createUnityInstance(document.querySelector("#unityContainer"), {
                    dataUrl: "Build/Snake Build.data",
                    frameworkUrl: "Build/Snake Build.framework.js",
                    codeUrl: "Build/Snake Build.wasm"
                });
                console.log("Unity Game Loaded Successfully");
            } catch (error) {
                console.error("Failed to load Unity game:", error);
            }
        }

        loadAndInitializeGame();
    </script>
</body>
</html>
